---
title: The association between Facebook adoption and well-being
shorttitle: Facebook and well-being
leftheader: Facebook and well-being
author: 
  - name: Matti Vuorre
    affiliation: 1
    address: Oxford Internet Institute, University of Oxford
    email: matti.vuorre@oii.ox.ac.uk
    role:
      - Design
      - Administration
      - Analysis
      - Visualization
      - Writing
  - name: Andrew K. Przybylski
    affiliation: 1
    corresponding: yes
    address: Oxford Internet Institute, University of Oxford
    email: andy.przybylski@oii.ox.ac.uk
    role:
      - Design
      - Administration
      - Funding
      - Resources
      - Supervision
      - Visualization
      - Writing

affiliation:
  - id: 1
    institution: Oxford Internet Institute, University of Oxford

authornote: |
  \noindent \textbf{This manuscript is not yet peer-reviewed.}
  
  This research was supported by the Huo Family Foundation and Economic and Social Research Council Grant ES/T008709/1. All code supporting this manuscript is available at X. This draft is available under [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) at X.
  
  The authors declare no conflicts of interest.
  
  The analytic code is available at (LINK). Researchers can contact Facebook (WHERE?) to access our code, the Facebook data, and a synthetic version of the Gallup data for reproducing and extending our analyses. 
  This study and methodology was reviewed and approved by the Oxford Internet Institute's Departmental Research Ethics Committee (SSH_OII_CIA_21_084).

abstract: | 
  Abstract.
  
keywords: well-being, social media
# wordcount: 
bibliography: "references.bib"
floatsintext: yes
linenumbers: no
draft: no
mask: no
figurelist: no
tablelist: no
footnotelist: no
header-includes:
  - |
    \makeatletter
    \renewcommand{\paragraph}{\@startsection{paragraph}{4}{\parindent}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-1em}%
      {\normalfont\normalsize\bfseries\typesectitle}}
    
    \renewcommand{\subparagraph}[1]{\@startsection{subparagraph}{5}{1em}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-\z@\relax}%
      {\normalfont\normalsize\bfseries\itshape\hspace{\parindent}{#1}\textit{\addperi}}{\relax}}
    \makeatother
    \usepackage{lipsum}

csl: "`r system.file('rmd', 'apa7.csl', package = 'papaja')`"
documentclass: apa7
classoption: jou
output: 
  papaja::apa6_pdf:
    number_sections: false
    keep_tex: false
  papaja::apa6_docx: 
    number_sections: false
editor_options: 
  chunk_output_type: console
always_allow_html: true
---

```{r setup, include = FALSE}
# Packages
library(papaja)
library(scales)
library(knitr)
library(patchwork)
library(ggh4x)
library(brms)
library(ggstance)
library(bayestestR)
library(tidyverse)

# For ordering outcomes
oo <- c(
  "Life_satisfaction", "Negative_experiences", "Positive_experiences"
)

# Directories for files
dir.create("models", FALSE)
dir.create("out", FALSE)

# Document options
opts_chunk$set(
  eval = TRUE,
  cache = TRUE,
  include = FALSE,
  warning = FALSE,
  dpi = 300,
  fig.align = "center"
)

# For tables: Show NAs as blanks
options(knitr.kable.NA = '')

# Plotting options
theme_set(
  theme_linedraw(
    base_size = 8
  ) +
    theme(
      panel.grid = element_blank(),
      strip.text = element_text(margin = margin(4, 4, 4, 4, "pt")),
      axis.text = element_text(size = rel(0.7)),
      axis.ticks = element_line(size = rel(0.4))
    )
)
W <- 24
```

```{r functions}
# Function to align positive and negative values
number2 <- function(x, accuracy = .01, pad = FALSE) {
  out <- number(
    x,
    accuracy = accuracy,
    style_negative = "hyphen"
    )
  
  # Justify on decimal point
  if (pad) {
    # Add white space to start of non-negative numbers
    out[str_starts(out, "[0-9]")] <- str_c(
      "\\phantom{-}", 
      out[str_starts(out, "[0-9]")]
    )
  }
  out
  
}
```

```{r data-prepare}
# Load and merge processed data
d_fb <- read_csv("data/fb.csv")
d_gwp <- read_rds("data/gwp.rds") 
# d_gwp <- read_rds("data/gwp-SYNTHETIC.rds") # If real data not available
d_gwp <- d_gwp %>% 
  mutate(outcome = factor(outcome, levels = oo))
d_pop <- read_rds("data/population.rds")

# Convert fb metrics into country-year proportions
d_fb <- d_fb %>% 
  left_join(d_pop) %>% 
  mutate(
    dau = dau / pop,
    mau = mau / pop
  ) %>% 
  select(-pop)

# Merge
d <- left_join(d_gwp, d_fb) %>% 
  mutate(age = factor(age, levels = c("13-34", "35+")))
```

```{r models}
# Set global contrasts
options(contrasts = c(unordered = "contr.sum", ordered = "contr.poly"))

# Prepare data
dm <- d %>% 
  # Centering predictors
  # Grand mean centering so both components are zero-centered
  mutate(across(c(dau, mau), ~. - mean(., na.rm = TRUE))) %>% 
  group_by(country) %>%
  mutate(
    # Between
    dau_cb = mean(dau, na.rm = TRUE),
    mau_cb = mean(mau, na.rm = TRUE),
    # Within
    dau_cw = dau - dau_cb, 
    mau_cw = mau - mau_cb
  ) %>% 
  ungroup() %>% 
  # Center year so that intercepts are at 2014
  mutate(year = year - 2014) %>% 
  # Remove rows where predictor existed but outcome didn't
  drop_na(val)

# Model formula
model_dau <- bf(
  val | se(se, sigma = TRUE) ~
    (year + dau_cw) * age * sex + dau_cb +
    ((year + dau_cw) * age * sex | country),
  family = gaussian()
)
model_mau <- bf(
  val | se(se, sigma = TRUE) ~
    (year + mau_cw) * age * sex + mau_cb +
    ((year + mau_cw) * age * sex | country),
  family = gaussian()
)

fits <- dm %>% 
  select(outcome, year, country, sex, age, contains("_c"), val, se) %>% 
  group_by(outcome) %>% 
  nest() %>% 
  mutate(
    dau = map2(
      data, outcome,
      ~brm(
        model_dau,
        cores = 8, chains = 4, threads = 2,
        backend = "cmdstanr",
        adapt_delta = .95,
        iter = 3000,
        data = .x,
        file = str_glue("models/brm-dau-{.y}")
      )
    ),
    mau = map2(
      data, outcome,
      ~brm(
        model_mau,
        cores = 8, chains = 4, threads = 2,
        backend = "cmdstanr",
        adapt_delta = .95,
        iter = 3000,
        data = .x,
        file = str_glue("models/brm-mau-{.y}")
      )
    )
  )
```

```{r coefficients-calculate}
# Calculate contrasts for each outcome
h_dau <- c(
  "Average" = "dau_cw = 0",
  "13-34_Female" = 
    "dau_cw + dau_cw:age1 * -1 + dau_cw:sex1 * -1 + dau_cw:age1:sex1 * 1 = 0",
  "13-34_Male" = 
    "dau_cw + dau_cw:age1 * -1 + dau_cw:sex1 * 1 + dau_cw:age1:sex1 * -1 = 0",
  "35+_Female" = 
    "dau_cw + dau_cw:age1 * 1 + dau_cw:sex1 * -1 + dau_cw:age1:sex1 * -1 = 0",
  "35+_Male" = 
    "dau_cw + dau_cw:age1 * 1 + dau_cw:sex1 * 1 + dau_cw:age1:sex1 * 1 = 0",
  "13-34" = "dau_cw + dau_cw:age1 * -1 = 0",
  "35+" = "dau_cw + dau_cw:age1 * 1 = 0",
  "Female" = "dau_cw + dau_cw:sex1 * -1 = 0",
  "Male" = "dau_cw + dau_cw:sex1 * 1 = 0",
  "Between-country" = "dau_cb = 0"
)
h_mau <- c(
  "Average" = "mau_cw = 0",
  "13-34_Female" = 
    "mau_cw + mau_cw:age1 * -1 + mau_cw:sex1 * -1 + mau_cw:age1:sex1 * 1 = 0",
  "13-34_Male" = 
    "mau_cw + mau_cw:age1 * -1 + mau_cw:sex1 * 1 + mau_cw:age1:sex1 * -1 = 0",
  "35+_Female" = 
    "mau_cw + mau_cw:age1 * 1 + mau_cw:sex1 * -1 + mau_cw:age1:sex1 * -1 = 0",
  "35+_Male" = 
    "mau_cw + mau_cw:age1 * 1 + mau_cw:sex1 * 1 + mau_cw:age1:sex1 * 1 = 0",
  "13-34" = "mau_cw + mau_cw:age1 * -1 = 0",
  "35+" = "mau_cw + mau_cw:age1 * 1 = 0",
  "Female" = "mau_cw + mau_cw:sex1 * -1 = 0",
  "Male" = "mau_cw + mau_cw:sex1 * 1 = 0",
  "Between-country" = "mau_cb = 0"
)
coefs <- fits %>% 
  select(-data) %>% 
  ungroup() %>% 
  pivot_longer(c(dau, mau), names_to = "predictor", values_to = "fit") %>% 
  mutate(h = if_else(predictor == "dau", list(h_dau), list(h_mau))) %>% 
  mutate(
    world = map2(
      fit, h,
      ~hypothesis(.x, .y) %>% 
        .[["hypothesis"]] %>%
        tibble()
    ),
    country = map2(
      fit, h,
      ~hypothesis(.x, .y, scope = "coef", group = "country") %>%
        .[["hypothesis"]] %>%
        tibble()
    )
  ) %>% 
  select(-fit, -h)

coefs <- coefs %>% 
  pivot_longer(c(world, country)) %>% 
  unnest(value) %>% 
  mutate(country = if_else(name == "country", as.character(Group), "World")) %>% 
  mutate(country = fct_relevel(country, "World")) %>% 
  # Between country contrast not country-specific!
  filter(!(Hypothesis == "Between-country" & country != "World"))

# Both predictor and outcome are 0-1, so scale can be interpreted as % change as a function of % change
```

The global investments into internet infrastructure, and its subsequent global adoption in the 1990's paved way for novel communication platforms that we today recognize as social media. Although a number of different platforms existed, from AOL Instant Messenger to LiveJournal and others, the market in the 2000s was dominated by first MySpace (launched in 2003), and then Facebook (launched in 2004), whose engagement numbers at 115 million surpassed those of MySpace in 2008. In the first quarter of 2022, Facebook reported 2.94 billion monthly active users [@metaMetaReportsFirst2022]---about one third of the entire population of the planet. Along with the increasingly widespread adoption of social media platforms in general, and Facebook in particular, worries about their potential harmful effects on individuals and societies proliferated, and are now as heated as ever in both academic and popular media.

Along with the increasing adoption of internet technologies [@vuorreGlobalWellbeingMental2022] and social media, the period of time surrounding circa 2008 marked dramatic expansion of the domains of life enabled and facilitated by Facebook, such as online marketplaces, news feeds, photo sharing, live-streaming, and many other features that recently have evolved under the "metaverse" term. The power of Facebook is not only defined by its features, but its profits, global spread, and informational influence by the late 2010s rivalled those of nation states. Yet, although its influence is widely recognized and consequences to well-being and mental health hotly debated, good evidence on its psychological consequences is lacking. Here, we use unique Facebook adoption data acquired from the company to investigate how its global adoption since is associated with changes in global levels of psychological well-being.

```{r}
tmp <- d_fb %>% 
  pivot_longer(c(dau, mau)) %>% 
  group_by(year, age, name) %>% 
  mutate(p20 = value > .2) %>% 
  summarise(p20 = percent(sum(p20) / n())) %>% 
  pivot_wider(names_from = year, values_from = p20) %>% 
  filter(name == "mau")
```

We examined 72 countries' per capita daily and monthly active Facebook users, as estimated by Facebook, as predictors of life satisfaction and negative and positive psychological experiences from the nationally representative Gallup World Poll survey from 2008 to 2019. We observed (Figure \@ref(fig:fig-data) A) that in 2010 13-34 year old monthly active Facebook users counted for over 20% of a nation's population in `r tmp[1, 5]` of the sample countries, and this number peaked at `r tmp[1, 13]` in 2018. While younger users FB adoption seemed to plateau around 20-30% of the whole population in many countries, we did not discern such clear plateau in the 35 and over age category. At the same time, we did not observe large and consistent changes in well-being (Figure \@ref(fig:fig-data) B).

```{r tab-world}
#| include: true

# Average within- and between-country associations
coefs %>% 
  filter(
    name == "world",
    Hypothesis %in% c("Average", "Between-country")
  ) %>% 
  mutate(
    predictor = if_else(
      predictor == "dau", 
      "Daily FB users", 
      "Monthly FB users"
    )
  ) %>%
  mutate(
    outcome = case_when(
      outcome == "Life_satisfaction" ~ "LS",
      outcome == "Negative_experiences" ~ "NE",
      outcome == "Positive_experiences" ~ "PE"
    )
  ) %>% 
  mutate(
    Estimate = number2(Estimate, pad = TRUE),
    across(c(starts_with("CI.")), ~number2(.)),
    result = str_glue("{Estimate} [{CI.Lower}, {CI.Upper}]")
  ) %>% 
  select(
    Predictor = predictor, Outcome = outcome, Hypothesis, result
  ) %>% 
  pivot_wider(names_from = Hypothesis, values_from = result) %>% 
  rename(
    `Within-country` = Average
  ) %>% 
  select(Predictor, Outcome, `Between-country`, `Within-country`) %>% 
  arrange(Predictor, Outcome) %>% 
  mutate(
    Predictor = if_else(Outcome == "LS", Predictor, ""),
    Predictor = str_remove(Predictor, " FB users")
  ) %>% 
  apa_table(
    caption = "Average Facebook engagement and well-being associations",
    font_size = "small",
    note = "'Predictor' indicates per capita daily / monthly Facebook users. LS: Life satisfaction, NE: Negative experiences: PE: Positive experiences. Numbers indicate posterior means and 95\\%CIs.",
    span_text_columns = FALSE,
    escape = FALSE,
    placement = "htb",
    align = 'llll'
  )
```

```{r fig-data}
#| include: true
#| out.width: "\\textwidth"
#| fig.env: "figure*"
#| fig.height: 5
#| fig.cap: "Time courses of key variables. A. Daily and monthly Facebook users in two age brackets for 72 countries from 2008 to 2019. B. Mean responses to three well-being scales in the Gallup World Poll from 72 countries from 2008 to 2019. LS: Life satisfaction, NE: Negative experiences: PE: Positive experiences."

# Figure of all variables over time
p_a <- d_fb %>% 
  pivot_longer(c(dau, mau), names_to = "outcome", values_to = "val") %>% 
  mutate(outcome = if_else(outcome == "dau", "Daily FB users", "Monthly FB users")) %>% 
  mutate(panel = str_glue("{outcome} ({age})")) %>% 
  ggplot(aes(year, val, group = country)) +
  scale_y_continuous(
    "Percentage of population", 
    expand = expansion(.03),
    breaks = extended_breaks(),
    labels = ~percent(.)
  ) +
  scale_x_continuous(
    "Year", 
    breaks = seq(2008, 2018, by = 2), 
    labels = ~str_replace(., "20", "'")
  ) +
  geom_line(size = .125) +
  # geom_smooth(group = 1, method = "gam", se = F) +
  facet_wrap("panel", nrow = 1) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank()
  )

p_b <- d %>% 
  select(-c(mau, dau)) %>% 
  # Exclude rows where FB data existed but not GWP data
  drop_na(val) %>% 
  # Actual lowest age in GWP
  mutate(age = factor(age, labels = c("15-34", "35+"))) %>% 
  mutate(
    outcome = case_when(
      outcome == "Life_satisfaction" ~ "LS",
      outcome == "Negative_experiences" ~ "NE",
      outcome == "Positive_experiences" ~ "PE"
    )
  ) %>% 
  mutate(panel = str_glue("{outcome} ({age})")) %>% 
  ggplot(aes(year, val, group = country)) +
  scale_color_brewer(palette = "Dark2") +
  scale_y_continuous(
    "Value", 
    expand = expansion(.01),
    breaks = extended_breaks(),
    labels = ~percent(.)
  ) +
  scale_x_continuous(
    "Year", 
    breaks = seq(2008, 2018, by = 2),
    labels = ~str_replace(., "20", "'")
  ) +
  # Aggregate over sex
  geom_line(size = .125) +
  # geom_smooth(group = 1, method = "gam", se = F) +
  facet_grid(
    sex~panel, 
    labeller = as_labeller(~str_replace(., "_", " "))
  ) +
  theme(legend.position = "none")


(p_a / p_b) +
  plot_layout(heights = c(4, 6)) +
  plot_annotation(tag_levels = "A")
# ggsave("out/Fig-data.png", width = W, height = W*.66, units = "cm", dpi = 400)
```

We first tested the extent to which countries' average per capita Facebook adoption predicted each of the three well-being metrics. Across countries, average MAU and DAU were positively associated with life satisfaction and positive experiences, and negatively with negative experiences (Table \@ref(tab:tab-world), Between-country estimates). However, there are large differences between countries in factors that might underlie differences in both social media adoption and well-being, such as socioeconomic conditions.

```{r fig-forest}
#| include: true
#| out.width: "\\textwidth"
#| fig.env: "figure*"
#| fig.height: 4.6
#| fig.cap: "Forest plot of estimated associations between Facebook adoption (top: Daily users, bottom: Monthly users) and three well-being metrics, separated by age category and sex. Units indicate percentage change in outcome as function of percentage increase in within-country centered per-capita Facebook adoption. Outcomes abbreviated as in Figure 1."

coefs %>%   
  filter(
    name != "world",
    str_detect(Hypothesis, "_")
  ) %>% 
  mutate(
    predictor = if_else(
      predictor == "dau", 
      "Daily FB users", 
      "Monthly FB users"
    )
  ) %>%
  separate(Hypothesis, c("Age", "Sex"), sep = "_") %>% 
  mutate(
    outcome = case_when(
      outcome == "Life_satisfaction" ~ "LS",
      outcome == "Negative_experiences" ~ "NE",
      outcome == "Positive_experiences" ~ "PE"
    )
  ) %>% 
  mutate(outcome = str_glue("{outcome} ({Sex})")) %>% 
  # [todo] order on e.g. younger age group's magnitude only maybe easier to look at
  mutate(
    # Order countries on increasing magnitude per panel
    country_order = interaction(predictor, outcome, country),
    country_order = fct_reorder(country_order, Estimate)
  ) %>% 
  ggplot(aes(Estimate, country_order, col = Age, shape = Star)) +
  scale_y_discrete("Country", expand = expansion(.015)) +
  scale_x_continuous(
    "Estimated association",
    expand = expansion(.1)
  ) +
  scale_shape_manual(values = c(21, 19)) +
  scale_color_brewer("Age", palette = "Set1") +
  geom_vline(xintercept = 0, lty = 2, size = .25, col = "grey50") +
  geom_linerangeh(
    aes(xmin = CI.Lower, xmax = CI.Upper),
    size = .15, position = position_dodgev(.4)
  ) +
  geom_point(
    fill = "white", size = .65,
    position = position_dodgev(.6)
  ) +
  facet_grid2(
    predictor~outcome, independent = "all", scales = "free",
    labeller = as_labeller(~str_replace(., "_", " "))
  ) +
  guides(shape = "none", size = "none") +
  theme(
    axis.ticks.y = element_blank(),
    axis.text.y = element_blank(),
    legend.position = "bottom"
  )

# ggsave("out/Fig-forest.png", width = W, height = W*.66, units = "cm", dpi = 400)
```

Differences between such confounding factors are likely to be much smaller within countries but over time. We therefore turned to the within-country associations, indexing the extent to which well-being in a given country was associated with that country's level of Facebook adoption. On average across the 72 countries in the dataset, we found that years with one percent greater than the average country's average DAU were associated with an 0.05% greater level of life satisfaction, 0.14% lower level of negative experiences, and 0.06% greater level of positive experiences (Table \@ref(tab:tab-world), Within-country estimates), and the latter two's credibility intervals excluded zero. The results were very similar when using MAU as predictor, although the association between MAU and NE was smaller and no longer credible at the 95% level. These results show that global Facebook adoption was associated with positive well-being in the 12 year period from 2008 to 2019.

```{r demographics}
coefs %>% 
  filter(
    Hypothesis %in% c("13-34", "35+", "Female", "Male"),
    name == "world"
  ) %>% 
  mutate(
    Estimate = number2(Estimate),
    across(c(starts_with("CI.")), ~number2(.)),
    result = str_glue("{Estimate} [{CI.Lower}, {CI.Upper}]")
  ) %>% 
  select(
    Predictor = predictor, Outcome = outcome, Hypothesis, result
  ) %>% 
  pivot_wider(names_from = Outcome, values_from = result)
```

However, the average estimates reported in Table \@ref(tab:tab-world)), while informative aggregates, do not describe any one individual country. They furthermore do not indicate associations separately for sexes or age groups. We present the within-country associations between Facebook adoption and well-being for each country, sex, and age group in Figure \@ref(fig:fig-forest). The association DAU & MAU and life satisfaction was overall more positive for younger (DAU: 0.11 and MAU: 0.07) than older individuals (DAU: -0.02, MAU: 0.02), with little difference between sexes. Similarly, DAU and MAU was associated more negatively with NE for young than older individuals (DAU: -0.34, MAU: -0.14), and slightly more positively with positive experiences for young (DAU: 0.07, MAU: 0.08) than older individuals (DAU: 0.04, MAU: 0.08).


Figure \@ref(fig:fig-forest) also shows that there are important differences in the associations linking Facebook adoption to well-being between countries. Some summaries.

```{r fig-ce-prepare}
#| eval: false
# Create a predictor table with evenly spaced mau_cw values for each country
newx_country <- fits$data[[1]] %>% 
  group_by(country, age, sex, mau_cb) %>% 
  filter(mau_cw %in% c(min(mau_cw), max(mau_cw))) %>% 
  select(country, age, sex, mau_cb, mau_cw) %>% 
  # For above groupings, create a sequence of dau_cws from min to max
  group_modify(
    ~tibble(mau_cw = seq(min(.$mau_cw), max(.$mau_cw), length = 31))
    ) %>% 
  ungroup() %>% 
  mutate(year = 0, se = 0)

newx_world <- fits$data[[1]] %>% 
  group_by(age, sex) %>% 
  filter(mau_cw %in% c(min(mau_cw), max(mau_cw))) %>% 
  select(age, sex, mau_cw) %>% 
  # For above groupings, create a sequence of mau_cws from min to max
  group_modify(
    ~tibble(mau_cw = seq(min(.$mau_cw), max(.$mau_cw), length = 31))
    ) %>% 
  ungroup() %>% 
  mutate(mau_cb = 0, year = 0, se = 0)

newy <- fits %>% 
  mutate(
    country = map(
      mau, 
      ~bind_cols(newx_country, fitted(.x, newx_country))
      ),
    world = map(
      mau, 
      ~bind_cols(newx_world, fitted(.x, newx_world, re_formula = NA))
      )
  ) %>% 
  select(outcome, country, world)
```

```{r fig-ce}
#| eval: false
#| include: true

newy %>% 
  pivot_longer(c(country, world)) %>% 
  unnest(value) %>% 
  ungroup() %>% 
  mutate(country = if_else(name == "world", "World", country)) %>% 
  ggplot(
    aes(mau_cw, Estimate, group = interaction(country, sex), col = sex, fill = sex)
    ) +
  scale_color_brewer(
    "Age", 
    palette = "Dark2", 
    aesthetics = c("color", "fill")
  ) +
  scale_y_continuous(
    "Estimated outcome",
    breaks = extended_breaks()
  ) +
  scale_x_continuous(
    "Country-mean deviated monthly FB users",
    breaks = extended_breaks(),
    labels = ~percent(.)
  ) +
  scale_size_manual(values = c(.2, .4)) +
  geom_ribbon(
    data = . %>% filter(name == "world"),
    aes(ymin = Q2.5, ymax = Q97.5),
    alpha = .2, col = NA
  ) +
  geom_line(aes(size = name)) +
  facet_grid(
    age~outcome, scales = "free_y",
    labeller = as_labeller(~str_replace(., "_", " "))
  ) +
  theme(legend.position = "none")
ggsave("out/Fig-mau-conditional.png", width = W, height = W*.5, units = "cm", dpi = 400)
```

Here we summarise everything and put it in context. \lipsum[1]

Here be much discussion regarding the results discussed above. \lipsum[2]

We end on recommendations. \lipsum[3]

# References

::: {#refs}
:::

# Supporting information

## Extended Methods

### Facebook engagement

```{r}
# Text list of countries
countries <- sort(unique(d_fb$country))
countries[length(countries)] <- paste("and", countries[length(countries)])
countries <- str_c(countries, collapse = ", ")
```

We studied two metrics of Facebook adoption, daily (DAU) and monthly active users (MAU), from 2008 to 2019 for 72 countries (`r countries`). FB estimates yearly DAU & MAU with their corresponding means from June 1 to August 31, and rounds values greater than 10,000,000 to three significant digits, and values less than 10,000,000 to the nearest 10,000. These estimates are calculated separately for individuals aged 13-34 and 35+. User age is determined based on Facebook profile information, which can be inaccurate (e.g. young individuals report an older age.) Accordingly, 0.008% of total MAU were trimmed to exclude accounts with unrealistic on non-reported age. An account's country is determined on a number of factors including the user's IP address and self-reported location.

Facebook defines users as individuals who visited Facebook or used Messenger during the appropriate period. Although accurately captured, these numbers are not perfect indicators of actual user numbers because of possible duplicate and false accounts. FB estimates those accounts to count for 11% and 5% of global MAUs, and that the former may be more likely in developing regions. Because internal criteria and methodology for determining duplicate and false accounts can change over time, estimates of MAU and DAU can also change.

### Well-being

```{r}
# N is max N over different outcomes
gwp_n <- d_gwp %>% 
  group_by(outcome) %>% 
  summarise(n = sum(n)) %>% 
  pull(n) %>% 
  max()

# N groups same logic
gwp_n_groups <- count(d_gwp, outcome) %>% 
  pull(n) %>% 
  max()
```

Gallup World Poll (GWP) is a nationally representative annual survey of 1,000 civilian, non-institutionalised individuals aged 15 years or older from 164 countries conducted since 2005. The surveys are conducted face-to-face or on the phone in the respondents’ native language and by local interviewers (for details, see [@gallupGallupWorldPoll2020; @gallupHowDoesGallup2014]). We studied Positive (PE) and Negative Experiences (NE), and life satisfaction. PE and NE measure respondents’ experienced well-being on the day before the survey with five items each. For PE, these items are: "Did you feel well-rested yesterday?", "Were you treated with respect all day yesterday?", "Did you smile or laugh a lot yesterday?", "Did you learn or do something interesting yesterday?, and "(Did you experience the following feelings during a lot of the day yesterday?) How about enjoyment?".

The NE items are responses to "Did you experience the following feelings during a lot of the day yesterday?" for physical pain, worry, sadness, stress, and anger? For analyses we used the means of these scales. Life satisfaction in the moment was measured with one 11-step Likert item, "Please imagine a ladder, with steps numbered from 0 at the bottom to 10 at the top. The top of the ladder represents the best possible life for you and the bottom of the ladder represents the worst possible life for you. On which step of the ladder would you say you personally feel you stand at this time?". For analyses, we scaled these variables to percentages, and aggregated the `r number(gwp_n, big.mark = ",")` individuals’ data to means and standard errors for each country, year, sex, and age (15-34 and 35+) combination (`r number(gwp_n_groups, big.mark = ",")` cells).

### Data analysis

Before analysing the data, we converted Facebook DAU and MAU to proportions of each country's yearly population sizes using population data from World Bank (midyear estimates; <https://data.worldbank.org/indicator/SP.POP.TOTL>). For Taiwan, we used population data from Wikipedia (<https://en.wikipedia.org/wiki/Demographics_of_Taiwan#Population_census>), because the World Bank data does not include Taiwan.

We examined the association between Facebook adoption and well-being through bayesian hierarchical regression models, estimated separately for DAU and MAU, and each of the three well-being outcomes. We regressed the outcome $y$ on time (decades, centered on 2014), within-country centered $x$ (DAU / MAU), age, sex, all the interactions except time by $x$, and the between-country centered DAU. We allowed all coefficients to vary randomly across the 72 countries, except the between-country predictor. Because we aggregated the outcomes, we included to standard errors of the outcome in the model to account for the varying group sizes. Formally, we specified the model as

\begin{align*} 
y_i &\sim \text{Normal}(\mu_i, \sigma^{y2}v_i) \\
\mu_i &= \alpha_{0} + \beta_{0\text{country}[i]} + \\
&\quad\ (\alpha_{1} + \beta_{1\text{country}[i]})\text{Sex}_i + \\
&\quad\ (\alpha_{2} + \beta_{2\text{country}[i]})\text{Age}_i + \\
&\quad\ (\alpha_{3} + \beta_{3\text{country}[i]})\text{Time}_i + \\
&\quad\ (\alpha_{4} + \beta_{4\text{country}[i]})\text{DAU}^{\text{CW}}_i + \\
&\quad\ (\alpha_{5} + \beta_{5\text{country}[i]})\text{Sex}_i \times \text{Time}_i + \\
&\quad\ (\alpha_{6} + \beta_{6\text{country}[i]})\text{Age}_i \times \text{Time}_i + \\
&\quad\ (\alpha_{7} + \beta_{7\text{country}[i]})\text{Sex}_i \times \text{Age}_i + \\
&\quad\ (\alpha_{8} + \beta_{8\text{country}[i]})\text{Sex}_i \times \text{Age}_i \times \text{Time}_i + \\
&\quad\ (\alpha_{9} + \beta_{9\text{country}[i]})\text{Sex}_i \times \text{DAU}^{\text{CW}}_i + \\
&\quad\ (\alpha_{10} + \beta_{10\text{country}[i]})\text{Age}_i \times \text{DAU}^{\text{CW}}_i + \\
&\quad\ (\alpha_{11} + \beta_{11\text{country}[i]})\text{Sex}_i \times \text{Age}_i \times \text{DAU}^{\text{CW}}_i + \\
&\quad\ \alpha_{12} \text{DAU}^{\text{CB}}_i
\\
\pmb{\beta} &\sim \text{MVN}(\pmb{0}, \Sigma)
\end{align*}

We conducted all data analyses with the R language for statistical computing [@rcoreteamLanguageEnvironmentStatistical2021] and estimated the models using Stan’s Hamiltonian Monte Carlo sampling via the brms R package [@burknerBrmsPackageBayesian2017; @standevelopmentteamStanModelingLanguage2021]. We used default noninformative priors, 4 HMC chains with 3,000 iterations and first 1,500 as warmup for 6,000 total iterations; we report all parameters with their posterior means and 95% credible intervals (posterior 2.5 and 97.5 percentiles; CI), and other posterior probabilities as indicated in text.
